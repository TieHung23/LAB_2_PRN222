@page
@model EVDMS.Presentation.Pages.Dealer.OrderModel
@{
    ViewData["Title"] = "Đơn hàng";
    Layout = "~/Pages/Shared/_DealerLayout.cshtml";
}

<style>
    table.table td, table.table th {
        vertical-align: middle;
    }

    /* Tổng kết ở cuối bảng */
    .summary-box {
        background-color: #f8f9fa;
        border: 2px solid #dee2e6;
        border-radius: 0.5rem;
        padding: 1rem 1.5rem;
        margin-top: 1.5rem;
    }

        .summary-box table {
            width: 100%;
            margin-bottom: 0;
        }

        .summary-box td {
            padding: 0.4rem 0;
            font-size: 1.05rem;
        }

        .summary-box .label {
            text-align: right;
            font-weight: 600;
        }

        .summary-box .value {
            text-align: right;
            font-weight: 700;
            color: #0f5132;
        }

            .summary-box .value.money {
                color: #198754;
            }
</style>

<div class="container mt-4">
    <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white d-flex align-items-center">
            <h4 class="mb-0">
                <i class="fas fa-file-invoice me-2"></i> Danh sách đơn hàng
            </h4>
        </div>

        <div class="card-body">
            @if (!Model.Orders.Any())
            {
                <p class="text-muted">Chưa có đơn hàng nào.</p>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-primary">
                            <tr class="text-center">
                                <th style="width: 15%">Mã đơn</th>
                                <th style="width: 15%">Khách hàng</th>
                                <th style="width: 12%">Xe</th>
                                <th style="width: 12%">Nhân viên</th>
                                <th style="width: 12%">Thanh toán</th>
                                <th style="width: 12%" class="text-end">Giá cuối</th>
                                <th style="width: 15%">Ngày tạo</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var order in Model.Orders)
                            {
                                <tr>
                                    <td>@order.Id</td>
                                    <td>@order.CustomerName</td>
                                    <td>@order.VehicleModel</td>
                                    <td>@order.StaffName</td>
                                    <td class="text-center">@order.PaymentStatus</td>
                                    <td class="text-end">@order.FinalPrice.ToString("N0") $</td>
                                    <td>@order.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @if (User.IsInRole("Dealer Manager"))
                {
                    <div class="summary-box shadow-sm">
                        <table>
                            <tr>
                                <td class="label">📊 Tổng số đơn:</td>
                                <td class="value">@Model.TotalOrders</td>
                            </tr>
                            <tr>
                                <td class="label">💰 Tổng doanh thu:</td>
                                <td class="value money">@Model.TotalRevenue.ToString("N0") $</td>
                            </tr>
                        </table>
                    </div>
                }
            }
        </div>
    </div>
</div>
